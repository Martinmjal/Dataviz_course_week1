

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Ejecución Tarea Week 1 &#8212; Tarea_week_1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Tarea_1';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Ejecución Semana 1 - Visualización de Datos" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Ejecución Semana 1 - Visualización de Datos
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Ejecución Tarea Week 1</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FTarea_1.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Tarea_1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ejecución Tarea Week 1</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ejecucion-tarea-week-1">
<h1>Ejecución Tarea Week 1<a class="headerlink" href="#ejecucion-tarea-week-1" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">from</span> <span class="nn">psycopg2</span> <span class="kn">import</span> <span class="n">Error</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.seasonal</span> <span class="kn">import</span> <span class="n">seasonal_decompose</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;estefany-martin-user&quot;</span><span class="p">,</span>
                                  <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
                                  <span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
                                  <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
                                  <span class="n">database</span><span class="o">=</span><span class="s2">&quot;estefany-martin-db&quot;</span><span class="p">)</span>

    <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PostgreSQL server information&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">get_dsn_parameters</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT version();&quot;</span><span class="p">)</span>
    <span class="n">record</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You are connected to - &quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while connecting to PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">connection</span><span class="p">):</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PostgreSQL connection is closed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PostgreSQL server information
{&#39;user&#39;: &#39;estefany-martin-user&#39;, &#39;channel_binding&#39;: &#39;prefer&#39;, &#39;dbname&#39;: &#39;estefany-martin-db&#39;, &#39;host&#39;: &#39;localhost&#39;, &#39;port&#39;: &#39;5432&#39;, &#39;options&#39;: &#39;&#39;, &#39;sslmode&#39;: &#39;prefer&#39;, &#39;sslcompression&#39;: &#39;0&#39;, &#39;sslcertmode&#39;: &#39;allow&#39;, &#39;sslsni&#39;: &#39;1&#39;, &#39;ssl_min_protocol_version&#39;: &#39;TLSv1.2&#39;, &#39;gssencmode&#39;: &#39;disable&#39;, &#39;krbsrvname&#39;: &#39;postgres&#39;, &#39;gssdelegation&#39;: &#39;0&#39;, &#39;target_session_attrs&#39;: &#39;any&#39;, &#39;load_balance_hosts&#39;: &#39;disable&#39;} 

You are connected to -  (&#39;PostgreSQL 16.0 (Debian 16.0-1.pgdg120+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 12.2.0-14) 12.2.0, 64-bit&#39;,) 

PostgreSQL connection is closed
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear Tabla employees</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;estefany-martin-user&quot;</span><span class="p">,</span>
                            <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
                            <span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
                            <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
                            <span class="n">database</span><span class="o">=</span><span class="s2">&quot;estefany-martin-db&quot;</span><span class="p">)</span>

<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39; DROP TABLE IF EXISTS employees&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE TABLE employees(</span>
<span class="s1">    employee_id INTEGER,</span>
<span class="s1">    first_name VARCHAR(20),</span>
<span class="s1">    last_name VARCHAR(25),</span>
<span class="s1">    email VARCHAR(25),</span>
<span class="s1">    phone_number VARCHAR(20),</span>
<span class="s1">    hire_date DATE,</span>
<span class="s1">    job_id VARCHAR(10),</span>
<span class="s1">    salary NUMERIC(8,2),</span>
<span class="s1">    commission_pct NUMERIC(2,2),</span>
<span class="s1">    manager_id INTEGER,</span>
<span class="s1">    department_id INTEGER</span>
<span class="s1">);</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE UNIQUE INDEX emp_emp_id_pk ON employees (employee_id)&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;ALTER TABLE employees ADD PRIMARY KEY (employee_id)&#39;&#39;&#39;</span><span class="p">)</span>
   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Table created successfully&quot;</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1">#  Consulta inicial </span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM employees LIMIT 10&quot;</span><span class="p">)</span> <span class="c1"># Seleccionar los primeros 10 registros (filas) de la tabla</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>  
    
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT count(1) FROM employees&quot;</span><span class="p">)</span> <span class="c1"># Contar el número total de empleados en la tabla, pero no hay datos</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Número de empleados: &quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Table created successfully
Número de empleados:  0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear Tabla courses</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;DROP TABLE IF EXISTS courses&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE TABLE courses (</span>
<span class="s1">    course_id SERIAL PRIMARY KEY,</span>
<span class="s1">    course_name VARCHAR(60),</span>
<span class="s1">    course_author VARCHAR(40),</span>
<span class="s1">    course_status VARCHAR(10) CHECK (course_status IN (&#39;published&#39;, &#39;draft&#39;, &#39;inactive&#39;)),</span>
<span class="s1">    course_published_dt DATE</span>
<span class="s1">);</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="c1"># Insertar datos</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39; INSERT INTO courses (course_name, course_author, course_status, course_published_dt)</span>
<span class="s1">VALUES</span>
<span class="s1">(&#39;Programming using Python&#39;, &#39;Bob Dillon&#39;, &#39;published&#39;, &#39;2020-09-30&#39;),</span>
<span class="s1">(&#39;Data Engineering using Python&#39;, &#39;Bob Dillon&#39;, &#39;published&#39;, &#39;2020-07-15&#39;),</span>
<span class="s1">(&#39;Data Engineering using Scala&#39;, &#39;Elvis Presley&#39;, &#39;draft&#39;, NULL),</span>
<span class="s1">(&#39;Programming using Scala&#39;, &#39;Elvis Presley&#39;, &#39;published&#39;, &#39;2020-05-12&#39;),</span>
<span class="s1">(&#39;Programming using Java&#39;, &#39;Mike Jack&#39;, &#39;inactive&#39;, &#39;2020-08-10&#39;),</span>
<span class="s1">(&#39;Web Applications - Python Flask&#39;, &#39;Bob Dillon&#39;, &#39;inactive&#39;, &#39;2020-07-20&#39;),</span>
<span class="s1">(&#39;Web Applications - Java Spring&#39;, &#39;Mike Jack&#39;, &#39;draft&#39;, NULL),</span>
<span class="s1">(&#39;Pipeline Orchestration - Python&#39;, &#39;Bob Dillon&#39;, &#39;draft&#39;, NULL),</span>
<span class="s1">(&#39;Streaming Pipelines - Python&#39;, &#39;Bob Dillon&#39;, &#39;published&#39;, &#39;2020-10-05&#39;),</span>
<span class="s1">(&#39;Web Applications - Scala Play&#39;, &#39;Elvis Presley&#39;, &#39;inactive&#39;, &#39;2020-09-30&#39;),</span>
<span class="s1">(&#39;Web Applications - Python Django&#39;, &#39;Bob Dillon&#39;, &#39;published&#39;, &#39;2020-06-23&#39;),</span>
<span class="s1">(&#39;Server Automation - Ansible&#39;, &#39;Uncle Sam&#39;, &#39;published&#39;, &#39;2020-07-05&#39;);</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="c1"># Consultas  </span>
<span class="c1"># Borrar cursos no publicados ni en modo borrador</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39; DELETE FROM courses WHERE course_status NOT IN (&#39;published&#39;, &#39;draft&#39;); &#39;&#39;&#39;</span><span class="p">)</span>

<span class="c1"># Obtener el recuento de cursos publicados por autor</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39; SELECT course_author, COUNT(*) AS course_count FROM courses</span>
<span class="s1">WHERE course_status = &#39;published&#39;</span>
<span class="s1">GROUP BY course_author</span>
<span class="s1">ORDER BY course_count DESC; &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    
<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;Bob Dillon&#39;, 4)
(&#39;Elvis Presley&#39;, 1)
(&#39;Uncle Sam&#39;, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear la tabla &quot;users&quot;</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;DROP TABLE IF EXISTS users&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE TABLE users (</span>
<span class="s1">    user_id SERIAL PRIMARY KEY,</span>
<span class="s1">    user_first_name VARCHAR(30),</span>
<span class="s1">    user_last_name VARCHAR(30),</span>
<span class="s1">    user_email_id VARCHAR(50),</span>
<span class="s1">    user_gender VARCHAR(1),</span>
<span class="s1">    user_unique_id VARCHAR(15),</span>
<span class="s1">    user_phone_no VARCHAR(20),</span>
<span class="s1">    user_dob DATE,</span>
<span class="s1">    created_ts TIMESTAMP</span>
<span class="s1">);</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="c1"># Insertar datos en la tabla &quot;users&quot;</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39; INSERT INTO users ( user_first_name, user_last_name, user_email_id, user_gender, </span>
<span class="s1">    user_unique_id, user_phone_no, user_dob, created_ts ) VALUES</span>
<span class="s1">    (&#39;Giuseppe&#39;, &#39;Bode&#39;, &#39;gbode0@imgur.com&#39;, &#39;M&#39;, &#39;88833-8759&#39;, </span>
<span class="s1">     &#39;+86 (764) 443-1967&#39;, &#39;1973-05-31&#39;, &#39;2018-04-15 12:13:38&#39;),</span>
<span class="s1">    (&#39;Lexy&#39;, &#39;Gisbey&#39;, &#39;lgisbey1@mail.ru&#39;, &#39;F&#39;, &#39;262501-029&#39;, </span>
<span class="s1">     &#39;+86 (751) 160-3742&#39;, &#39;2003-05-31&#39;, &#39;2020-12-29 06:44:09&#39;),</span>
<span class="s1">    (&#39;Karel&#39;, &#39;Claringbold&#39;, &#39;kclaringbold2@yale.edu&#39;, &#39;F&#39;, &#39;391-33-2823&#39;, </span>
<span class="s1">     &#39;+62 (445) 471-2682&#39;, &#39;1985-11-28&#39;, &#39;2018-11-19 00:04:08&#39;),</span>
<span class="s1">    (&#39;Marv&#39;, &#39;Tanswill&#39;, &#39;mtanswill3@dedecms.com&#39;, &#39;F&#39;, &#39;1195413-80&#39;, </span>
<span class="s1">     &#39;+62 (497) 736-6802&#39;, &#39;1998-05-24&#39;, &#39;2018-11-19 16:29:43&#39;),</span>
<span class="s1">    (&#39;Gertie&#39;, &#39;Espinoza&#39;, &#39;gespinoza4@nationalgeographic.com&#39;, &#39;M&#39;, &#39;471-24-6869&#39;, </span>
<span class="s1">     &#39;+249 (687) 506-2960&#39;, &#39;1997-10-30&#39;, &#39;2020-01-25 21:31:10&#39;),</span>
<span class="s1">    (&#39;Saleem&#39;, &#39;Danneil&#39;, &#39;sdanneil5@guardian.co.uk&#39;, &#39;F&#39;, &#39;192374-933&#39;, </span>
<span class="s1">     &#39;+63 (810) 321-0331&#39;, &#39;1992-03-08&#39;, &#39;2020-11-07 19:01:14&#39;),</span>
<span class="s1">    (&#39;Rickert&#39;, &#39;O&#39;&#39;Shiels&#39;, &#39;roshiels6@wikispaces.com&#39;, &#39;M&#39;, &#39;749-27-47-52&#39;, </span>
<span class="s1">     &#39;+86 (184) 759-3933&#39;, &#39;1972-11-01&#39;, &#39;2018-03-20 10:53:24&#39;),</span>
<span class="s1">    (&#39;Cybil&#39;, &#39;Lissimore&#39;, &#39;clissimore7@pinterest.com&#39;, &#39;M&#39;, &#39;461-75-4198&#39;, </span>
<span class="s1">     &#39;+54 (613) 939-6976&#39;, &#39;1978-03-03&#39;, &#39;2019-12-09 14:08:30&#39;),</span>
<span class="s1">    (&#39;Melita&#39;, &#39;Rimington&#39;, &#39;mrimington8@mozilla.org&#39;, &#39;F&#39;, &#39;892-36-676-2&#39;, </span>
<span class="s1">     &#39;+48 (322) 829-8638&#39;, &#39;1995-12-15&#39;, &#39;2018-04-03 04:21:33&#39;),</span>
<span class="s1">    (&#39;Benetta&#39;, &#39;Nana&#39;, &#39;bnana9@google.com&#39;, &#39;M&#39;, &#39;197-54-1646&#39;, </span>
<span class="s1">     &#39;+420 (934) 611-0020&#39;, &#39;1971-12-07&#39;, &#39;2018-10-17 21:02:51&#39;),</span>
<span class="s1">    (&#39;Gregorius&#39;, &#39;Gullane&#39;, &#39;ggullanea@prnewswire.com&#39;, &#39;F&#39;, &#39;232-55-52-58&#39;, </span>
<span class="s1">     &#39;+62 (780) 859-1578&#39;, &#39;1973-09-18&#39;, &#39;2020-01-14 23:38:53&#39;),</span>
<span class="s1">    (&#39;Una&#39;, &#39;Glayzer&#39;, &#39;uglayzerb@pinterest.com&#39;, &#39;M&#39;, &#39;898-84-336-6&#39;, </span>
<span class="s1">     &#39;+380 (840) 437-3981&#39;, &#39;1983-05-26&#39;, &#39;2019-09-17 03:24:21&#39;),</span>
<span class="s1">    (&#39;Jamie&#39;, &#39;Vosper&#39;, &#39;jvosperc@umich.edu&#39;, &#39;M&#39;, &#39;247-95-68-44&#39;, </span>
<span class="s1">     &#39;+81 (205) 723-1942&#39;, &#39;1972-03-18&#39;, &#39;2020-07-23 16:39:33&#39;),</span>
<span class="s1">    (&#39;Calley&#39;, &#39;Tilson&#39;, &#39;ctilsond@issuu.com&#39;, &#39;F&#39;, &#39;415-48-894-3&#39;, </span>
<span class="s1">     &#39;+229 (698) 777-4904&#39;, &#39;1987-06-12&#39;, &#39;2020-06-05 12:10:50&#39;),</span>
<span class="s1">    (&#39;Peadar&#39;, &#39;Gregorowicz&#39;, &#39;pgregorowicze@omniture.com&#39;, &#39;M&#39;, &#39;403-39-5-869&#39;, </span>
<span class="s1">     &#39;+7 (267) 853-3262&#39;, &#39;1996-09-21&#39;, &#39;2018-05-29 23:51:31&#39;),</span>
<span class="s1">    (&#39;Jeanie&#39;, &#39;Webling&#39;, &#39;jweblingf@booking.com&#39;, &#39;F&#39;, &#39;399-83-05-03&#39;, </span>
<span class="s1">     &#39;+351 (684) 413-0550&#39;, &#39;1994-12-27&#39;, &#39;2018-02-09 01:31:11&#39;),</span>
<span class="s1">    (&#39;Yankee&#39;, &#39;Jelf&#39;, &#39;yjelfg@wufoo.com&#39;, &#39;F&#39;, &#39;607-99-0411&#39;, </span>
<span class="s1">     &#39;+1 (864) 112-7432&#39;, &#39;1988-11-13&#39;, &#39;2019-09-16 16:09:12&#39;),</span>
<span class="s1">    (&#39;Blair&#39;, &#39;Aumerle&#39;, &#39;baumerleh@toplist.cz&#39;, &#39;F&#39;, &#39;430-01-578-5&#39;, </span>
<span class="s1">     &#39;+7 (393) 232-1860&#39;, &#39;1979-11-09&#39;, &#39;2018-10-28 19:25:35&#39;),</span>
<span class="s1">    (&#39;Pavlov&#39;, &#39;Steljes&#39;, &#39;psteljesi@macromedia.com&#39;, &#39;F&#39;, &#39;571-09-6181&#39;, </span>
<span class="s1">     &#39;+598 (877) 881-3236&#39;, &#39;1991-06-24&#39;, &#39;2020-09-18 05:34:31&#39;),</span>
<span class="s1">    (&#39;Darn&#39;, &#39;Hadeke&#39;, &#39;dhadekej@last.fm&#39;, &#39;M&#39;, &#39;478-32-02-87&#39;, </span>
<span class="s1">     &#39;+370 (347) 110-4270&#39;, &#39;1984-09-04&#39;, &#39;2018-02-10 12:56:00&#39;),</span>
<span class="s1">    (&#39;Wendell&#39;, &#39;Spanton&#39;, &#39;wspantonk@de.vu&#39;, &#39;F&#39;, null, </span>
<span class="s1">     &#39;+84 (301) 762-1316&#39;, &#39;1973-07-24&#39;, &#39;2018-01-30 01:20:11&#39;),</span>
<span class="s1">    (&#39;Carlo&#39;, &#39;Yearby&#39;, &#39;cyearbyl@comcast.net&#39;, &#39;F&#39;, null, </span>
<span class="s1">     &#39;+55 (288) 623-4067&#39;, &#39;1974-11-11&#39;, &#39;2018-06-24 03:18:40&#39;),</span>
<span class="s1">    (&#39;Sheila&#39;, &#39;Evitts&#39;, &#39;sevittsm@webmd.com&#39;, null, &#39;830-40-5287&#39;,</span>
<span class="s1">     null, &#39;1977-03-01&#39;, &#39;2020-07-20 09:59:41&#39;),</span>
<span class="s1">    (&#39;Sianna&#39;, &#39;Lowdham&#39;, &#39;slowdhamn@stanford.edu&#39;, null, &#39;778-0845&#39;, </span>
<span class="s1">     null, &#39;1985-12-23&#39;, &#39;2018-06-29 02:42:49&#39;),</span>
<span class="s1">    (&#39;Phylys&#39;, &#39;Aslie&#39;, &#39;paslieo@qq.com&#39;, &#39;M&#39;, &#39;368-44-4478&#39;, </span>
<span class="s1">     &#39;+86 (765) 152-8654&#39;, &#39;1984-03-22&#39;, &#39;2019-10-01 01:34:28&#39;);</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CONSULTAS</span>
<span class="c1"># Obtener el número de usuarios creados por año</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39; SELECT EXTRACT(YEAR FROM created_ts) AS created_year, COUNT(*) AS user_count</span>
<span class="s1">FROM users GROUP BY created_year ORDER BY created_year; &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;created_year&#39;</span><span class="p">,</span> <span class="s1">&#39;user_count&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  created_year  user_count
0         2018          13
1         2019           4
2         2020           8
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtener los días de nacimiento de los usuarios nacidos en mayo</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39; SELECT user_id, user_dob, user_email_id, TO_CHAR(user_dob, &#39;Day&#39;) AS user_day_of_birth</span>
<span class="s1">FROM users WHERE EXTRACT(MONTH FROM user_dob) = 5 ORDER BY EXTRACT(DAY FROM user_dob); &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_dob&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_day_of_birth&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   user_id    user_dob            user_email_id user_day_of_birth
0        4  1998-05-24   mtanswill3@dedecms.com         Sunday   
1       12  1983-05-26  uglayzerb@pinterest.com         Thursday 
2        1  1973-05-31         gbode0@imgur.com         Thursday 
3        2  2003-05-31         lgisbey1@mail.ru         Saturday 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtener los nombres e ids de correo electrónico de los usuarios añadidos en el año 2019</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39; SELECT user_id, UPPER(user_first_name || &#39; &#39; || user_last_name) AS user_name, user_email_id, created_ts, EXTRACT(YEAR FROM created_ts) AS created_year</span>
<span class="s1">FROM users WHERE EXTRACT(YEAR FROM created_ts) = 2019 ORDER BY user_name; &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email_id&#39;</span><span class="p">,</span> <span class="s1">&#39;created_ts&#39;</span><span class="p">,</span> <span class="s1">&#39;created_year&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   user_id        user_name              user_email_id          created_ts  \
0        8  CYBIL LISSIMORE  clissimore7@pinterest.com 2019-12-09 14:08:30   
1       25     PHYLYS ASLIE             paslieo@qq.com 2019-10-01 01:34:28   
2       12      UNA GLAYZER    uglayzerb@pinterest.com 2019-09-17 03:24:21   
3       17      YANKEE JELF           yjelfg@wufoo.com 2019-09-16 16:09:12   

  created_year  
0         2019  
1         2019  
2         2019  
3         2019  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtener el número de usuarios por género</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">SELECT </span>
<span class="s1">    CASE </span>
<span class="s1">        WHEN user_gender = &#39;M&#39; THEN &#39;Male&#39;</span>
<span class="s1">        WHEN user_gender = &#39;F&#39; THEN &#39;Female&#39;</span>
<span class="s1">        ELSE &#39;Not Specified&#39;</span>
<span class="s1">    END AS gender, COUNT(1) AS user_count</span>
<span class="s1">FROM users</span>
<span class="s1">GROUP BY user_gender</span>
<span class="s1">ORDER BY user_count DESC; &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;user_count&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          gender  user_count
0         Female          13
1           Male          10
2  Not Specified           2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtener los 4 últimos dígitos de los ids únicos</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">SELECT user_id, user_unique_id, </span>
<span class="s1">    CASE </span>
<span class="s1">        WHEN user_unique_id IS NULL THEN &#39;Not Specified&#39;</span>
<span class="s1">        WHEN LENGTH(REGEXP_REPLACE(user_unique_id, &#39;[^0-9]&#39;, &#39;&#39;, &#39;g&#39;)) &lt; 9 THEN &#39;Invalid Unique Id&#39;</span>
<span class="s1">        ELSE RIGHT(REGEXP_REPLACE(user_unique_id, &#39;[^0-9]&#39;, &#39;&#39;, &#39;g&#39;), 4)</span>
<span class="s1">    END AS user_unique_id_last4</span>
<span class="s1">FROM users ORDER BY user_id;</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_unique_id_last4&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    user_id user_unique_id user_unique_id_last4
0         1     88833-8759                 8759
1         2     262501-029                 1029
2         3    391-33-2823                 2823
3         4     1195413-80                 1380
4         5    471-24-6869                 6869
5         6     192374-933                 4933
6         7   749-27-47-52                 4752
7         8    461-75-4198                 4198
8         9   892-36-676-2                 6762
9        10    197-54-1646                 1646
10       11   232-55-52-58                 5258
11       12   898-84-336-6                 3366
12       13   247-95-68-44                 6844
13       14   415-48-894-3                 8943
14       15   403-39-5-869                 5869
15       16   399-83-05-03                 0503
16       17    607-99-0411                 0411
17       18   430-01-578-5                 5785
18       19    571-09-6181                 6181
19       20   478-32-02-87                 0287
20       21           None        Not Specified
21       22           None        Not Specified
22       23    830-40-5287                 5287
23       24       778-0845    Invalid Unique Id
24       25    368-44-4478                 4478
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtener recuento de usuarios en función del código de país.</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    SELECT</span>
<span class="s1">        regexp_replace(SUBSTRING(user_phone_no FROM &#39;\+(\d+)&#39;), &#39;[^0-9]&#39;, &#39;&#39;) AS country_code,</span>
<span class="s1">        COUNT(*) AS user_count</span>
<span class="s1">    FROM users</span>
<span class="s1">    WHERE user_phone_no IS NOT NULL</span>
<span class="s1">    GROUP BY country_code</span>
<span class="s1">    ORDER BY CAST(regexp_replace(SUBSTRING(user_phone_no FROM &#39;\+(\d+)&#39;), &#39;[^0-9]&#39;, &#39;&#39;) AS INTEGER); &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country_code&#39;</span><span class="p">,</span> <span class="s1">&#39;user_count&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   country_code  user_count
0             1           1
1             7           2
2            48           1
3            54           1
4            55           1
5            62           3
6            63           1
7            81           1
8            84           1
9            86           4
10          229           1
11          249           1
12          351           1
13          370           1
14          380           1
15          420           1
16          598           1
</pre></div>
</div>
</div>
</div>
<p>BASE DE DATOS CARDANO</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Leer los datos del CSV</span>
<span class="n">df_cardano</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/ADA-USD.csv&quot;</span><span class="p">)</span>

<span class="c1"># Crear tabla cardano_price</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;DROP TABLE IF EXISTS cardano_price&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE TABLE cardano_price(</span>
<span class="s1">    Date DATE PRIMARY KEY,</span>
<span class="s1">    Open NUMERIC,</span>
<span class="s1">    High NUMERIC,</span>
<span class="s1">    Low NUMERIC,</span>
<span class="s1">    Close NUMERIC,</span>
<span class="s1">    Adj_Close NUMERIC,</span>
<span class="s1">    Volume NUMERIC -- Cambiamos el tipo de dato a NUMERIC</span>
<span class="s1">);</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Table created successfully&quot;</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># Iterar a través de las filas del DataFrame e insertar cada fila en la tabla</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_cardano</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">insert_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    INSERT INTO cardano_price (Date, Open, High, Low, Close, Adj_Close, Volume)</span>
<span class="s2">    VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">);</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">insert_query</span><span class="p">,</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;High&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Low&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Volume&#39;</span><span class="p">]))</span>

<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">df_cardano</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Table created successfully
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017-10-01</td>
      <td>0.021678</td>
      <td>0.032226</td>
      <td>0.017354</td>
      <td>0.024969</td>
      <td>0.024969</td>
      <td>50068700.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017-10-02</td>
      <td>0.024607</td>
      <td>0.030088</td>
      <td>0.019969</td>
      <td>0.025932</td>
      <td>0.025932</td>
      <td>57641300.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017-10-03</td>
      <td>0.025757</td>
      <td>0.027425</td>
      <td>0.020690</td>
      <td>0.020816</td>
      <td>0.020816</td>
      <td>16997800.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017-10-04</td>
      <td>0.020864</td>
      <td>0.022806</td>
      <td>0.020864</td>
      <td>0.021931</td>
      <td>0.021931</td>
      <td>9000050.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2017-10-05</td>
      <td>0.021951</td>
      <td>0.022154</td>
      <td>0.020859</td>
      <td>0.021489</td>
      <td>0.021489</td>
      <td>5562510.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Información general sobre los datos</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_cardano</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1475 entries, 0 to 1474
Data columns (total 7 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Date       1475 non-null   object 
 1   Open       1471 non-null   float64
 2   High       1471 non-null   float64
 3   Low        1471 non-null   float64
 4   Close      1471 non-null   float64
 5   Adj Close  1471 non-null   float64
 6   Volume     1471 non-null   float64
dtypes: float64(6), object(1)
memory usage: 80.8+ KB
None
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Estadísticas descriptivas básicas</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_cardano</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              Open         High          Low        Close    Adj Close  \
count  1471.000000  1471.000000  1471.000000  1471.000000  1471.000000   
mean      0.374234     0.393359     0.354385     0.375726     0.375726   
std       0.609602     0.639195     0.578952     0.611501     0.611501   
min       0.018414     0.021050     0.017354     0.018539     0.018539   
25%       0.047560     0.049503     0.046073     0.047592     0.047592   
50%       0.093398     0.096776     0.090105     0.093434     0.093434   
75%       0.301339     0.318211     0.283567     0.301889     0.301889   
max       2.966390     3.099186     2.907606     2.968239     2.968239   

             Volume  
count  1.471000e+03  
mean   1.090947e+09  
std    2.258370e+09  
min    1.739460e+06  
25%    5.366896e+07  
50%    1.359691e+08  
75%    6.999972e+08  
max    1.914198e+10  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear el gráfico Candlestick</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Candlestick</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_cardano</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span>
                <span class="nb">open</span><span class="o">=</span><span class="n">df_cardano</span><span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">],</span>
                <span class="n">high</span><span class="o">=</span><span class="n">df_cardano</span><span class="p">[</span><span class="s1">&#39;High&#39;</span><span class="p">],</span>
                <span class="n">low</span><span class="o">=</span><span class="n">df_cardano</span><span class="p">[</span><span class="s1">&#39;Low&#39;</span><span class="p">],</span>
                <span class="n">close</span><span class="o">=</span><span class="n">df_cardano</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">])</span>
       <span class="p">])</span>

<span class="c1"># Personalizar el diseño del gráfico</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cardano USD (ADA-USD) Candlestick Chart&quot;</span><span class="p">,</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Price (USD)&quot;</span><span class="p">,</span>
    <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;Courier New, monospace&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;RebeccaPurple&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Opcional: Ocultar el rango deslizante en el eje x</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_rangeslider_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Mostrar el gráfico</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Aplicar la prueba de Dickey-Fuller a los datos de cierre de Cardano</span>
<span class="c1">#Eliminar valores nulos</span>
<span class="n">df_cardano</span> <span class="o">=</span> <span class="n">df_cardano</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">df_cardano</span> <span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Comprueba si la serie es estacionaria en función del p-valor</span>
<span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie temporal es estacionaria.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie temporal no es estacionaria.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ADF Statistic: -0.531337
p-value: 0.885755
La serie temporal no es estacionaria.
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Ejecución Semana 1 - Visualización de Datos</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Estefany Villanueva, Martín Álvarez
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>